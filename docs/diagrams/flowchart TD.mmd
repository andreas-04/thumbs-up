flowchart TD
    Start([User visits https://pi.local:8443]) --> CheckCookie{Has valid<br/>auth cookie?}
    
    CheckCookie -->|No| AdminLogin[/admin/login<br/>PIN Entry Page]
    CheckCookie -->|Yes Guest Token| FileBrowser[/<br/>File Browser]
    
    AdminLogin --> EnterPIN{Enter PIN}
    EnterPIN -->|Invalid| AdminLogin
    EnterPIN -->|Valid| AdminDashboard[/admin<br/>Admin Dashboard]
    
    AdminDashboard --> AdminActions{Admin Action}
    AdminActions -->|Generate Token| CreateToken[Create New<br/>Guest Token]
    AdminActions -->|Revoke Token| DeleteToken[Delete<br/>Guest Token]
    AdminActions -->|View| ShowList[Show Expandable<br/>Token List]
    
    CreateToken --> QRDisplay[Display QR Code<br/>in List Item]
    ShowList --> ClickExpand{Click to<br/>Expand}
    ClickExpand --> QRDisplay
    
    QRDisplay --> GuestScans([Guest scans<br/>QR code])
    GuestScans --> AuthEndpoint[/auth?token=xxx]
    AuthEndpoint --> SetCookie[Set HttpOnly<br/>Cookie]
    SetCookie --> RedirectHome[Redirect to /]
    RedirectHome --> FileBrowser
    
    FileBrowser --> GuestActions{Guest Action}
    GuestActions -->|Browse| Navigate[Navigate folders]
    GuestActions -->|Download| GetFile[Download file]
    GuestActions -->|Upload| PostFile[Upload file]
    
    Navigate --> FileBrowser
    GetFile --> FileBrowser
    PostFile --> FileBrowser
    
    DeleteToken --> AdminDashboard
    
    style AdminLogin fill:#ffe0e0
    style AdminDashboard fill:#e0ffe0
    style FileBrowser fill:#e0e0ff
    style QRDisplay fill:#ffffcc