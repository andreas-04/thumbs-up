stateDiagram-v2
    [*] --> DORMANT
    
    state DORMANT {
        [*] --> Idle
        Idle: âŒ No mDNS broadcast
        Idle: âŒ No services listening
        Idle: ðŸ”’ Storage locked (LUKS)
    }
    
    DORMANT --> ADVERTISING: Button Press / Manual Activation
    
    state ADVERTISING {
        [*] --> Waiting
        Waiting: ðŸ“¡ Avahi broadcasts mDNS
        Waiting: ðŸ”“ mTLS service listening (port 8443)
        Waiting: ðŸ”’ Storage still locked
        Waiting: â³ Waiting for authenticated client
    }
    
    ADVERTISING --> ACTIVE: Client connects + mTLS succeeds
    ADVERTISING --> DORMANT: Timeout / No connections
    
    state ACTIVE {
        [*] --> Serving
        Serving: ðŸ”“ LUKS storage unlocked
        Serving: ðŸ“‚ NFS mounted (client-specific rules)
        Serving: ðŸ›¡ï¸ Firewall rules per client IP
        Serving: ðŸ“ Logging all access
        Serving: ðŸ‘ï¸ Monitoring activity
        
        state Serving {
            [*] --> SingleClient
            SingleClient --> MultipleClients: Additional client connects
            MultipleClients --> SingleClient: Client disconnects
            SingleClient --> [*]: Last client disconnects
        }
    }
    
    ACTIVE --> ACTIVE: Additional clients connect/disconnect
    ACTIVE --> DORMANT: All clients disconnect + inactivity timeout
    
    state DORMANT {
        Cleanup: ðŸ“‚ Unmount NFS
        Cleanup: ðŸ”’ Lock storage (LUKS)
        Cleanup: ðŸ›¡ï¸ Remove firewall rules
        Cleanup: âŒ Stop mDNS broadcast
    }
    
    DORMANT --> [*]: Device powered off