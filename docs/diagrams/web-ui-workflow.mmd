flowchart TD
    Start(["User visits pi.local:8443"]) --> CheckCookie{Has valid auth cookie?}
    
    CheckCookie -->|No| AdminLogin["Admin Login: Enter PIN"]
    CheckCookie -->|Yes Guest Token| FileBrowser["File Browser"]
    
    AdminLogin -->|Invalid PIN| AdminLogin
    AdminLogin -->|Valid PIN| AdminDashboard["Admin Dashboard"]
    
    AdminDashboard --> AdminActions{Admin Action}
    AdminActions -->|Generate Token| CreateToken["Generate & Display QR Code"]
    AdminActions -->|Revoke Token| DeleteToken["Revoke Token"]
    
    CreateToken --> AdminDashboard
    DeleteToken --> AdminDashboard
    
    CreateToken -.Guest scans QR.-> AuthEndpoint["Set Cookie & Redirect"]
    AuthEndpoint --> FileBrowser
    
    FileBrowser --> GuestActions{Guest Action}
    GuestActions -->|Browse| FileBrowser
    GuestActions -->|Download| FileBrowser
    GuestActions -->|Upload| FileBrowser
    
    style AdminLogin fill:#ffe0e0
    style AdminDashboard fill:#e0ffe0
    style FileBrowser fill:#e0e0ff
    style CreateToken fill:#ffffcc
